(function(e){function n(n){for(var o,a,c=n[0],u=n[1],s=n[2],p=0,l=[];p<c.length;p++)a=c[p],i[a]&&l.push(i[a][0]),i[a]=0;for(o in u)Object.prototype.hasOwnProperty.call(u,o)&&(e[o]=u[o]);d&&d(n);while(l.length)l.shift()();return r.push.apply(r,s||[]),t()}function t(){for(var e,n=0;n<r.length;n++){for(var t=r[n],o=!0,c=1;c<t.length;c++){var u=t[c];0!==i[u]&&(o=!1)}o&&(r.splice(n--,1),e=a(a.s=t[0]))}return e}var o={},i={app:0},r=[];function a(n){if(o[n])return o[n].exports;var t=o[n]={i:n,l:!1,exports:{}};return e[n].call(t.exports,t,t.exports,a),t.l=!0,t.exports}a.m=e,a.c=o,a.d=function(e,n,t){a.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:t})},a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,n){if(1&n&&(e=a(e)),8&n)return e;if(4&n&&"object"===typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(a.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var o in e)a.d(t,o,function(n){return e[n]}.bind(null,o));return t},a.n=function(e){var n=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(n,"a",n),n},a.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},a.p="/";var c=window["webpackJsonp"]=window["webpackJsonp"]||[],u=c.push.bind(c);c.push=n,c=c.slice();for(var s=0;s<c.length;s++)n(c[s]);var d=u;r.push([0,"chunk-vendors"]),t()})({0:function(e,n,t){e.exports=t("56d7")},1:function(e,n){},"21bb":function(e,n,t){"use strict";var o=t("4c07"),i=t.n(o);i.a},"4a19":function(e,n,t){},"4c07":function(e,n,t){},5606:function(e,n,t){"use strict";var o=t("6237"),i=t.n(o);i.a},"56d7":function(e,n,t){"use strict";t.r(n);t("3a0f"),t("a3a3"),t("4d0b");var o=t("329b"),i=function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("div",{attrs:{id:"app"}},[t("router-view")],1)},r=[],a=(t("5c0b"),t("048f")),c={},u=Object(a["a"])(c,i,r,!1,null,null,null);u.options.__file="App.vue";var s=u.exports,d=t("b8e5"),p=function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("div",{staticClass:"home"},[t("div",{staticClass:"center"},[e._v("\n        登录名："),t("input",{directives:[{name:"model",rawName:"v-model",value:e.account,expression:"account"}],attrs:{type:"text"},domProps:{value:e.account},on:{input:function(n){n.target.composing||(e.account=n.target.value)}}}),t("br"),e._v("\n        房间号："),t("input",{directives:[{name:"model",rawName:"v-model",value:e.roomid,expression:"roomid"}],attrs:{type:"text"},domProps:{value:e.roomid},on:{input:function(n){n.target.composing||(e.roomid=n.target.value)}}}),t("br"),t("button",{on:{click:e.join}},[e._v("加入房间")])])])},l=[],f={name:"home",data:function(){return{roomid:"",account:""}},methods:{join:function(){this.account&&this.roomid&&this.$router.push({name:"room",params:{roomid:this.roomid,account:this.account}})}}},m=f,v=(t("21bb"),Object(a["a"])(m,p,l,!1,null,null,null));v.options.__file="Home.vue";var h=v.exports,b=function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("div",{staticClass:"room"},[t("div",{staticClass:"video-box"},[t("video",{ref:"video-mine",staticClass:"video-mine",attrs:{autoplay:"",controls:""}}),t("video",{ref:"video-other",staticClass:"video-other",attrs:{autoplay:"",controls:""}})])])},w=[],g=t("497e"),_=t.n(g),y=location.origin;console.log(location);var j=_.a.connect(y),O=j,x={name:"home",data:function(){return{roomid:"",pper:null,peer1:null,candidate:null}},methods:{init:function(){var e=this,n=this.$refs["video-mine"],t=this.$refs["video-other"],o={iceServers:[{url:"stun:stun.l.google.com:19302"}]},i=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,r=window.PeerConnection||window.webkitPeerConnection00||window.webkitRTCPeerConnection||window.mozRTCPeerConnection;return this.pper=new r(o),this.pper.onaddstream=function(e){t&&(t.srcObject=e.stream)},this.pper.onicecandidate=function(n){n.candidate&&(e.candidate=n.candidate)},new Promise(function(t,o){i.call(navigator,{audio:!0,video:!0},function(o){n.srcObject=o,e.pper.addStream(o),t()},function(e){o(e)})})},sendOfferFn:function(e){var n=this;this.pper.setLocalDescription(e,function(){O.emit("offer",{sdp:n.pper.localDescription,roomid:n.$route.params.roomid})})},sendAnswerFn:function(e){var n=this;this.pper.setLocalDescription(e,function(){O.emit("answer",{sdp:n.pper.localDescription,roomid:n.$route.params.roomid})})},socketInit:function(){this.pper.createOffer({offerToReceiveAudio:1,offerToReceiveVideo:1}).then(this.sendOfferFn)}},mounted:function(){var e=this;this.$nextTick(function(){O.emit("join",{roomid:e.$route.params.roomid,account:e.$route.params.account}),O.on("offer",function(n){e.pper.setRemoteDescription(n,function(){e.pper.createAnswer().then(e.sendAnswerFn)},function(){})}),O.on("answer",function(n){e.pper.setRemoteDescription(n,function(){},function(){})}),O.on("__ice_candidate",function(n){n&&e.pper.addIceCandidate(n).catch(function(){})}),O.on("__ice_candidatepeer",function(n){n&&e.peer1.addIceCandidate(n).catch(function(){})}),O.on("joined",function(n){e.init().then(function(){O.emit("__ice_candidate",{candidate:e.candidate,roomid:e.$route.params.roomid}),2===n.length&&e.socketInit()})})})}},C=x,P=(t("5606"),Object(a["a"])(C,b,w,!1,null,null,null));P.options.__file="room.vue";var $=P.exports;o["a"].use(d["a"]);var k=new d["a"]({routes:[{path:"/",name:"home",component:h},{path:"/room/:roomid/:account",name:"room",component:$}]}),M=t("f2de");o["a"].use(M["a"]);var S=new M["a"].Store({state:{},mutations:{},actions:{}});O.on("connect",function(){console.log("连接成功")}),O.on("disconnect",function(){console.log("连接断开了")}),o["a"].config.productionTip=!1,new o["a"]({router:k,store:S,render:function(e){return e(s)}}).$mount("#app")},"5c0b":function(e,n,t){"use strict";var o=t("4a19"),i=t.n(o);i.a},6237:function(e,n,t){}});