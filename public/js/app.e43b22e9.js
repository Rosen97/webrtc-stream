(function(e){function t(t){for(var o,a,c=t[0],u=t[1],s=t[2],l=0,f=[];l<c.length;l++)a=c[l],r[a]&&f.push(r[a][0]),r[a]=0;for(o in u)Object.prototype.hasOwnProperty.call(u,o)&&(e[o]=u[o]);d&&d(t);while(f.length)f.shift()();return i.push.apply(i,s||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],o=!0,c=1;c<n.length;c++){var u=n[c];0!==r[u]&&(o=!1)}o&&(i.splice(t--,1),e=a(a.s=n[0]))}return e}var o={},r={app:0},i=[];function a(t){if(o[t])return o[t].exports;var n=o[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=o,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)a.d(n,o,function(t){return e[t]}.bind(null,o));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="/";var c=window["webpackJsonp"]=window["webpackJsonp"]||[],u=c.push.bind(c);c.push=t,c=c.slice();for(var s=0;s<c.length;s++)t(c[s]);var d=u;i.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},1:function(e,t){},"21bb":function(e,t,n){"use strict";var o=n("4c07"),r=n.n(o);r.a},"4a19":function(e,t,n){},"4c07":function(e,t,n){},5606:function(e,t,n){"use strict";var o=n("6237"),r=n.n(o);r.a},"56d7":function(e,t,n){"use strict";n.r(t);n("3a0f"),n("a3a3"),n("4d0b");var o=n("329b"),r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[n("router-view")],1)},i=[],a=(n("5c0b"),n("048f")),c={},u=Object(a["a"])(c,r,i,!1,null,null,null);u.options.__file="App.vue";var s=u.exports,d=n("b8e5"),l=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"home"},[n("div",{staticClass:"center"},[e._v("\n        登录名："),n("input",{directives:[{name:"model",rawName:"v-model",value:e.account,expression:"account"}],attrs:{type:"text"},domProps:{value:e.account},on:{input:function(t){t.target.composing||(e.account=t.target.value)}}}),n("br"),e._v("\n        房间号："),n("input",{directives:[{name:"model",rawName:"v-model",value:e.roomid,expression:"roomid"}],attrs:{type:"text"},domProps:{value:e.roomid},on:{input:function(t){t.target.composing||(e.roomid=t.target.value)}}}),n("br"),n("button",{on:{click:e.join}},[e._v("加入房间")])])])},f=[],p={name:"home",data:function(){return{roomid:"",account:""}},methods:{join:function(){this.account&&this.roomid&&this.$router.push({name:"room",params:{roomid:this.roomid,account:this.account}})}}},m=p,v=(n("21bb"),Object(a["a"])(m,l,f,!1,null,null,null));v.options.__file="Home.vue";var h=v.exports,b=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"room"},[n("div",{ref:"video-box",staticClass:"video-box"},[n("video",{ref:"video-mine",staticClass:"video-mine",attrs:{autoplay:"",controls:""}})])])},g=[],w=(n("25d7"),n("497e")),_=n.n(w),y=location.origin,$=_.a.connect(y),j=$,O={name:"home",data:function(){return{roomid:"",peer:null,peerList:{},candidate:null,localStream:null}},watch:{userList:{handler:function(){},deep:!0}},beforeDestroy:function(){for(var e in j.emit("leave",{roomid:this.$route.params.roomid,account:this.$route.params.account}),this.peerList)this.peerList[e].close(),this.peerList[e]=null},methods:{getUserMedia:function(){var e=this,t=this.$refs["video-mine"],n=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;return new Promise(function(o,r){n.call(navigator,{audio:!0,video:!0},function(n){t.srcObject=n,e.localStream=n,o(n)},function(e){r(e)})})},getPeerConnection:function(e){var t=this,n=this.$refs["video-box"],o={iceServers:[{url:"stun:stun.l.google.com:19302"},{url:"turn:120.77.253.101:3478",username:"inter_user",credential:"power_turn"}]},r=window.PeerConnection||window.webkitPeerConnection00||window.webkitRTCPeerConnection||window.mozRTCPeerConnection,i=new r(o);i.addStream(this.localStream),i.onaddstream=function(t){var o=document.querySelector("#"+e.account);if(o)o.srcObject=t.stream;else{var r=document.createElement("video");r.controls=!0,r.autoplay="autoplay",r.srcObject=t.stream,r.id=e.account,n.append(r)}},i.onicecandidate=function(n){n.candidate&&j.emit("__ice_candidate",{candidate:n.candidate,roomid:t.$route.params.roomid,account:e.account})},this.peerList[e.account]=i},createOffer:function(e,t){var n=this;t.createOffer({offerToReceiveAudio:1,offerToReceiveVideo:1}).then(function(o){t.setLocalDescription(o,function(){j.emit("offer",{sdp:t.localDescription,roomid:n.$route.params.roomid,account:e})})})},socketInit:function(){var e=this;j.on("offer",function(t){e.peerList[t.account].setRemoteDescription(t.sdp,function(){e.peerList[t.account].createAnswer().then(function(n){e.peerList[t.account].setLocalDescription(n,function(){j.emit("answer",{sdp:e.peerList[t.account].localDescription,roomid:e.$route.params.roomid,account:t.account})})})},function(){})}),j.on("answer",function(t){e.peerList[t.account].setRemoteDescription(t.sdp,function(){},function(){})}),j.on("__ice_candidate",function(t){t.candidate&&e.peerList[t.account].addIceCandidate(t.candidate).catch(function(){})}),j.on("disconnected",function(e){var t=document.querySelector("#"+e);t&&t.remove()})}},mounted:function(){var e=this;this.$nextTick(function(){e.getUserMedia().then(function(){j.emit("join",{roomid:e.$route.params.roomid,account:e.$route.params.account})}),e.socketInit(),j.on("joined",function(t,n){if(t.length>1&&(t.forEach(function(t){var n={};t.account>e.$route.params.account?n.account=t.account+e.$route.params.account:n.account=e.$route.params.account+t.account,e.peerList[n.account]||t.account===e.$route.params.account||e.getPeerConnection(n)}),n===e.$route.params.account))for(var o in e.peerList)e.createOffer(o,e.peerList[o])})})}},x=O,L=(n("5606"),Object(a["a"])(x,b,g,!1,null,null,null));L.options.__file="room.vue";var P=L.exports;o["a"].use(d["a"]);var C=new d["a"]({routes:[{path:"/",name:"home",component:h},{path:"/room/:roomid/:account",name:"room",component:P}]}),S=n("f2de");o["a"].use(S["a"]);var k=new S["a"].Store({state:{},mutations:{},actions:{}});j.on("connect",function(){console.log("连接成功")}),j.on("disconnect",function(){console.log("连接断开了")}),o["a"].config.productionTip=!1,new o["a"]({router:C,store:k,render:function(e){return e(s)}}).$mount("#app")},"5c0b":function(e,t,n){"use strict";var o=n("4a19"),r=n.n(o);r.a},6237:function(e,t,n){}});